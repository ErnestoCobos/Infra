---
all:
  children:
    sonarqube:
      hosts:
        # SonarQube Server via Tailscale MagicDNS
        sonarqube:
          ansible_host: "sonarqube"  # Tailscale hostname
          ansible_user: c0305
          ansible_ssh_private_key_file: ~/.ssh/id_ed25519

        # On-Premise via Tailscale
        # sonar-onprem:
        #   ansible_host: "nombre-servidor"  # Tailscale hostname
        #   ansible_user: c0305
        #   ansible_ssh_private_key_file: ~/.ssh/id_ed25519

      vars:
        # Sudo password for become
        ansible_become_password: "{{ lookup('env', 'ANSIBLE_BECOME_PASSWORD') }}"

        # PostgreSQL
        sonarqube_db_name: sonarqube
        sonarqube_db_user: sonaruser
        sonarqube_db_password: "{{ lookup('env', 'SONARQUBE_DB_PASSWORD') | default('ChangeMeNow!2024', true) }}"

        # SonarQube
        sonarqube_version: "25.12.0.117093"
        sonarqube_port: 9000

        # SonarScanner
        sonarscanner_version: "8.0.1.6346"

        # Cloudflare Tunnel (token específico para este host)
        cloudflare_tunnel_token: "{{ lookup('env', 'SONARQUBE_TUNNEL_TOKEN') }}"

    # Gateway/Proxy Server (Proxmox - arda)
    # Acceso: jump → pve → arda
    gateway:
      hosts:
        arda:
          ansible_host: "arda"  # Hostname interno en PVE
          ansible_user: root
          ansible_ssh_private_key_file: ~/.ssh/id_ed25519
          ansible_ssh_common_args: '-o ProxyJump=root@pve'

      vars:
        # Cloudflare
        cloudflare_tunnel_token: "{{ lookup('env', 'CLOUDFLARE_TUNNEL_TOKEN') }}"

        # Domain configuration
        gateway_base_domain: "voltaflow.com"

        # Internal services via Tailscale
        sonarqube_internal_host: "vf-sonarqube"  # Tailscale hostname del SonarQube

        # Services to expose
        gateway_services:
          - name: sonarqube
            domain: "sonarqube.voltaflow.com"
            upstream: "http://vf-sonarqube:9000"
